<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>image-cropper</title>
</head>
<body style="display: flex">
<canvas id="image-cropper" style="width: 800px; height: 600px;"></canvas>
<button id="reset-button">Reset</button>
<button id="Animate">Animate</button>
<div>
    <img id="image-preview" src="" alt="Preview"
         style="display: none; width: 300px; height: 300px; object-fit: contain;">
    <p id="info"></p>
</div>

<script type="module" src="/src/image-cropper.ts"></script>
<script type="module">
    import ImageCropper from "./src/image-cropper.js";

    const cropper = new ImageCropper(document.getElementById('image-cropper'), {
        // backgroundBoxSize: 25,
        // backgroundBoxColor1: '#f47171',
        // backgroundBoxColor2: '#5b8ebf',
        // guidelineWidth: 2,
        // guidelineColor1: 'rgba(255,0,0,0.53)',
        // guidelineColor2: 'rgba(0,59,255,0.53)',
        // guidelineDsah: 8,
        // borderWidth: 1,
        // borderColor1: 'rgb(255,0,0)',
        // borderColor2: 'rgba(0,59,255,0.53)',
        outWidth: 300,
        outHeight: 300,
        // outType: 0,
        // circle: true,
        // circleRadius: 10,
        defaultClipRect: {left: 100, top: 100, right: 100, bottom: 100},
    });


    const image = new Image();
    image.crossOrigin = "anonymous"; // 必须在 src 之前设置
    image.src = 'img.png';
    image.onload = () => {
        cropper.setImage(image)
    }

    function preview() {
        cropper.toDataUrl().then((url) => {
            const preview = document.getElementById('image-preview')
            preview.src = url
            preview.style.display = 'block'
            //获得真实图片大小
            const img = new Image()
            img.src = url
            img.onload = () => {
                document.getElementById('info').innerHTML = `
                图片尺寸：${image.width} x ${image.height}<br>
                裁剪尺寸：${img.width} x ${img.height}<br>
            `
            }
        }).catch((error) => {
        })
        requestAnimationFrame(preview)
    }

    requestAnimationFrame(preview)


    document.getElementById('reset-button').addEventListener('click', () => {
        cropper.reset()
        const preview = document.getElementById('image-preview')
        preview.style.display = 'none'
    })

    document.getElementById('Animate').addEventListener('click', () => {
      cropper.aa()
    })


</script>
</body>

</html>
