(function(m,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(m=typeof globalThis<"u"?globalThis:m||self,m.ImageCropperLib=u())})(this,(function(){"use strict";const m="data:image/svg+xml;base64,PHN2ZyB0PSIxNzYzMzA4NTgxNTE3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE1NzAiCiAgICAgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj4KICAgIDxwYXRoIGQ9Ik00MjEuMTIgNTkwLjUwNjY2N0wzNjIuNjY2NjY3IDY0OC41MzMzMzNhMzI5LjM4NjY2NyAzMjkuMzg2NjY3IDAgMCAxIDIzLjQ2NjY2Ni00MDkuMTczMzMzIDguNTMzMzMzIDguNTMzMzMzIDAgMCAwLTkuODEzMzMzLTEzLjIyNjY2NyAzMTAuMTg2NjY3IDMxMC4xODY2NjcgMCAwIDAtODMuMiA0OTIuMzczMzM0TDI0MS45MiA3NjhhMTcuMDY2NjY3IDE3LjA2NjY2NyAwIDAgMCAxMS45NDY2NjcgMjkuMDEzMzMzaDE3OS4yYTE3LjA2NjY2NiAxNy4wNjY2NjcgMCAwIDAgMTcuMDY2NjY2LTE3LjA2NjY2NnYtMTc5LjJhMTcuMDY2NjY3IDE3LjA2NjY2NyAwIDAgMC0yOS4wMTMzMzMtMTAuMjR6TTYwMi44OCA0MzMuNDkzMzMzTDY2MS4zMzMzMzMgMzc1LjQ2NjY2N2EzMjkuMzg2NjY3IDMyOS4zODY2NjcgMCAwIDEtMjEuMzMzMzMzIDQwOS4xNzMzMzMgOC41MzMzMzMgOC41MzMzMzMgMCAwIDAgOS44MTMzMzMgMTMuMjI2NjY3IDMxMC4xODY2NjcgMzEwLjE4NjY2NyAwIDAgMCA4MS4wNjY2NjctNDkyLjM3MzMzNEw3ODIuMDggMjU2YTE3LjA2NjY2NyAxNy4wNjY2NjcgMCAwIDAtMTEuOTQ2NjY3LTI5LjAxMzMzM2gtMTc5LjJhMTcuMDY2NjY3IDE3LjA2NjY2NyAwIDAgMC0xNy4wNjY2NjYgMTcuMDY2NjY2djE3OS4yYTE3LjA2NjY2NyAxNy4wNjY2NjcgMCAwIDAgMjkuMDEzMzMzIDEwLjI0eiIKICAgICAgICAgIHAtaWQ9IjE1NzEiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMjAiPjwvcGF0aD4KPC9zdmc+";class u{constructor(t,e,i,s){this.angle=0,this.width=t,this.height=e,this.path=s,this.viewBox=i}clone(){const t=new u(this.width,this.height,this.viewBox,this.path);return t.setAngle(this.angle),t}setAngle(t){this.angle=t}setViewBox(t,e,i,s){this.viewBox=[t,e,i,s]}draw(t,e,i,s="#000",h,c=1){if(!this.path||this.path.length===0)return;t.save(),t.lineJoin="round",t.lineCap="round";let r=0,n=0,M=this.width,g=this.height;this.viewBox&&([r,n,M,g]=this.viewBox);const I=e/M,D=i/g,w=Math.min(I,D);t.translate(e/2,i/2),t.rotate(this.angle*Math.PI/180),t.scale(w,w),t.translate(-M/2-r+.5/w,-g/2-n+.5/w);const p=new Path2D;for(const N of this.path)p.addPath(new Path2D(N));t.strokeStyle=s,t.lineWidth=Math.max(1,c/w),t.stroke(p),h&&(t.fillStyle=h,t.fill(p)),t.restore()}}const v=new u(24,24,[0,0,24,24],[`M13.6,12c0,0.9-0.7,1.6-1.6,1.6s-1.6-0.7-1.6-1.6s0.7-1.6,1.6-1.6S13.6,11.1,13.6,12z M21,10.4v3.3h-2.1
	c-0.6,2.6-2.7,4.7-5.3,5.3V21h-3.3v-2.1c-2.6-0.6-4.7-2.7-5.3-5.3H3v-3.3h2.1c0.6-2.6,2.7-4.7,5.3-5.3V3h3.3v2.1
	c2.6,0.6,4.7,2.7,5.3,5.3H21z M16.7,12c0-2.6-2.1-4.7-4.7-4.7S7.3,9.4,7.3,12s2.1,4.7,4.7,4.7S16.7,14.6,16.7,12z`]),y=new u(24,24,[0,0,24,24],["M0,4.96h24V11H0V4.96z"]),L=new u(24,24,[0,0,24,24],["M12.91,4.96 L0,4.96 L0,11 L12.91,11 L12.91,24 L18.95,24 L18.95,11 L18.95,4.96 Z"]);class o{constructor(t,e){this.x=t,this.y=e}}class z{constructor(t,e,i){this.x=t,this.y=e,this.z=i}}class a{constructor(t,e,i,s){this.left=t,this.top=e,this.right=i,this.bottom=s}static fromSize(t,e,i,s){return new a(t,e,t+i,e+s)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}get center(){return new o((this.right-this.left)/2,(this.bottom-this.top)/2)}clone(){return new a(this.left,this.top,this.right,this.bottom)}}class f{constructor(t,e,i){this.layoutList=[],this.rect=new a(0,0,0,0),this.parent=null,this.config={backgroundBoxSize:10,backgroundBoxColor0:"#fff",backgroundBoxColor1:"#ddd",guidelineWidth:1,guidelineColor1:"#ffffff60",guidelineColor2:"#00000060",guidelineDsah:4,borderWidth:1.5,borderColor1:"#000000",borderColor2:"#ffffff",pointRadius:12},this.parent=t,this.cursor=e,Object.assign(this.config,i)}setRect(t){this.rect=t}getRect(){return this.rect}getRoot(){let t=this.parent;for(;t?.parent;)t=t.parent;return t}checkPointInRect(t){return t.x>=this.rect.left&&t.x<=this.rect.right&&t.y>=this.rect.top&&t.y<=this.rect.bottom}start(t){for(let e=this.layoutList.length-1;e>=0;e--)if(this.layoutList[e].start(t))return!0;return!1}move(t){for(let e=this.layoutList.length-1;e>=0;e--)if(this.layoutList[e].move(t))return!0;return!1}end(t){for(let e=this.layoutList.length-1;e>=0;e--)if(this.layoutList[e].end(t))return!0;return!1}wheel(t){for(let e=this.layoutList.length-1;e>=0;e--)if(this.layoutList[e].wheel(t))return!0;return!1}over(){this.getRoot()?.setCursor(this.cursor)}out(){}checkOverOut(t){for(let e=this.layoutList.length-1;e>=0;e--)if(this.layoutList[e].checkOverOut(t))return!0;return this.checkPointInRect(t)?(this.getRoot()?.setOverLayout(this,t),!0):!1}draw(t){for(const e of this.layoutList)t.save(),e.draw(t),t.restore()}remove(){this.parent?.layoutList.splice(this.parent.layoutList.indexOf(this),1)}}class b extends f{constructor(t,e){super(t,"crosshair",e),this.mousePoint=new o(0,0),this.selectRect=new a(0,0,0,0),this.onStartSelect=null,this.onMoveSelect=null,this.onEndSelect=null}setOutSize(t,e){this.outWidth=t,this.outHeight=e}setOnStartSelect(t){this.onStartSelect=t}setOnMoveSelect(t){this.onMoveSelect=t}setOnEndSelect(t){this.onEndSelect=t}start(t){return this.mousePoint=t,this.selectRect=new a(t.x,t.y,t.x,t.y),this.onStartSelect?.call(this,this.selectRect),!0}move(t){const e=this.selectRect.clone();if(e.right+=t.x-this.mousePoint.x,e.bottom+=t.y-this.mousePoint.y,this.outWidth&&this.outHeight){const i=Math.min(e.width/this.outWidth,e.height/this.outHeight);e.right=e.left+this.outWidth*i,e.bottom=e.top+this.outHeight*i}return this.selectRect=e,this.mousePoint=t,this.onMoveSelect?.call(this,this.selectRect),!0}end(){return this.onEndSelect?.call(this,this.selectRect),!0}draw(t){const{left:e,top:i,right:s,bottom:h}=this.rect,c=s-e,r=h-i;for(let n=0;n<r;n+=this.config.backgroundBoxSize){let M=Math.floor(n/this.config.backgroundBoxSize)%2?this.config.backgroundBoxColor0:this.config.backgroundBoxColor1;for(let g=0;g<c;g+=this.config.backgroundBoxSize)t.fillStyle=M=M===this.config.backgroundBoxColor1?this.config.backgroundBoxColor0:this.config.backgroundBoxColor1,t.fillRect(g,n,this.config.backgroundBoxSize,this.config.backgroundBoxSize)}}}class R extends f{constructor(t,e="auto"){super(t,e),this.scale=1,this.angle=0,this.clipRect=new a(0,0,0,0),this.offset=new o(0,0),this.outType=0}setOutSize(t,e,i=0){this.outWidth=t,this.outHeight=e,this.outType=i}reset(){this.angle=0,this.offset=new o(0,0),this.clipRect=new a(this.rect.left,this.rect.top,this.rect.right,this.rect.bottom);const t=this.rect.width/this.image.width,e=this.rect.height/this.image.height;this.scale=Math.min(t,e)}setRect(t){super.setRect(t),this.clipRect=new a(t.left,t.top,t.right,t.bottom)}setClipRect(t){const e=new o(this.clipRect.left+this.clipRect.width/2-(t.left+t.width/2),this.clipRect.top+this.clipRect.height/2-(t.top+t.height/2));this.moveImage(e),this.clipRect=t}setImage(t){this.image=t;const e=this.rect.width/t.width,i=this.rect.height/t.height;this.scale=Math.min(e,i)}setRotate(t){this.angle-=t}start(){return!1}move(){return!1}end(){return!1}wheel(t){return t.y<0?this.scale*=1+.1:this.scale*=1-.1,this.scale=Math.max(.1,Math.min(5,this.scale)),!0}moveImage(t){const e=Math.cos(-this.angle*Math.PI/180),i=Math.sin(-this.angle*Math.PI/180),s=t.x*e-t.y*i,h=t.x*i+t.y*e;this.offset.x+=s/this.scale,this.offset.y+=h/this.scale}draw(t){if(!this.image)return;const e=new o(this.clipRect.left+this.clipRect.width/2,this.clipRect.top+this.clipRect.height/2);t.translate(e.x,e.y),t.scale(this.scale,this.scale),t.rotate(this.angle*Math.PI/180),t.translate(this.offset.x,this.offset.y),t.drawImage(this.image,-this.image.width/2,-this.image.height/2)}getClipCanvas(){const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("no canvas context");let i=1;return this.outType==0&&(this.outWidth&&this.outHeight?i=Math.min(this.outWidth/this.clipRect.width,this.outHeight/this.clipRect.height):this.outWidth?i=this.outWidth/this.clipRect.width:this.outHeight&&(i=this.outHeight/this.clipRect.height)),t.width=this.clipRect.width*i,t.height=this.clipRect.height*i,e.translate(t.width/2,t.height/2),e.scale(this.scale*i,this.scale*i),e.rotate(this.angle*Math.PI/180),e.translate(this.offset.x,this.offset.y),e.drawImage(this.image,-this.image.width/2,-this.image.height/2,this.image.width,this.image.height),t}toBlob(t,e){return this.image?new Promise((i,s)=>{try{this.getClipCanvas().toBlob(h=>{i(h)},t??"image/png",e)}catch(h){s(h)}}):Promise.reject(new Error("image not loaded"))}toDataUrl(t,e){return this.image?new Promise((i,s)=>{try{i(this.getClipCanvas().toDataURL(t??"image/png",e))}catch(h){s(h)}}):Promise.reject(new Error("image not loaded"))}}class C extends f{constructor(t,e="move",i){super(t,e,i),this.layoutList=[],this.isChecked=!1,this.mousePoint=new o(0,0),this.onMoveLayout=null,this.onEndSelect=null,this.center=new k(this,v,0,"move",i),this.topLeft=new l(this,L,-90,"nwse-resize",i),this.topCenter=new l(this,y,0,"ns-resize",i),this.topRight=new l(this,L,0,"nesw-resize",i),this.centerLeft=new l(this,y,-90,"ew-resize",i),this.centerRight=new l(this,y,90,"ew-resize",i),this.bottomLeft=new l(this,L,180,"nesw-resize",i),this.bottomCenter=new l(this,y,180,"ns-resize",i),this.bottomRight=new l(this,L,90,"nwse-resize",i),this.topLeft.setOnMoveLayout(this.onMoveTopLeft.bind(this)),this.topCenter.setOnMoveLayout(this.onMoveTopCenter.bind(this)),this.topRight.setOnMoveLayout(this.onMoveTopRight.bind(this)),this.centerLeft.setOnMoveLayout(this.onMoveCenterLeft.bind(this)),this.centerRight.setOnMoveLayout(this.onMoveCenterRight.bind(this)),this.bottomLeft.setOnMoveLayout(this.onMoveBottomLeft.bind(this)),this.bottomCenter.setOnMoveLayout(this.onMoveBottomCenter.bind(this)),this.bottomRight.setOnMoveLayout(this.onMoveBottomRight.bind(this)),this.topLeft.setOnEndLayout(this.onEndLayout.bind(this)),this.topCenter.setOnEndLayout(this.onEndLayout.bind(this)),this.topRight.setOnEndLayout(this.onEndLayout.bind(this)),this.centerLeft.setOnEndLayout(this.onEndLayout.bind(this)),this.centerRight.setOnEndLayout(this.onEndLayout.bind(this)),this.bottomLeft.setOnEndLayout(this.onEndLayout.bind(this)),this.bottomCenter.setOnEndLayout(this.onEndLayout.bind(this)),this.bottomRight.setOnEndLayout(this.onEndLayout.bind(this)),this.layoutList=[this.topLeft,this.topCenter,this.topRight,this.centerLeft,this.centerRight,this.bottomLeft,this.bottomCenter,this.bottomRight,this.center]}onEndLayout(){this.onEndSelect?.call(this,this.rect)}setOnMoveLayout(t){this.onMoveLayout=t}setOnEndSelect(t){this.onEndSelect=t}onMoveTopLeft(t){const e=this.rect.clone();if(e.left+=t.x,e.top+=t.y,this.outWidth&&this.outHeight){const i=this.outWidth>this.outHeight?e.width/this.outWidth:e.height/this.outHeight,s=this.outWidth*i,h=this.outHeight*i;e.left+=e.width-s,e.top+=e.height-h}this.rect=e,this.setRect(this.rect)}onMoveTopCenter(t){const e=this.rect.clone();if(e.top+=t.y,this.outWidth&&this.outHeight){const i=e.height/this.outHeight,s=this.outWidth*i;e.left+=(e.width-s)/2,e.right=e.left+s,e.bottom=e.top+this.outHeight*i}this.rect=e,this.setRect(this.rect)}onMoveTopRight(t){const e=this.rect.clone();if(e.right+=t.x,e.top+=t.y,this.outWidth&&this.outHeight){const i=this.outWidth>this.outHeight?e.width/this.outWidth:e.height/this.outHeight;e.right=e.left+this.outWidth*i,e.top+=e.height-this.outHeight*i}this.rect=e,this.setRect(this.rect)}onMoveCenterLeft(t){const e=this.rect.clone();if(e.left+=t.x,this.outWidth&&this.outHeight){const i=e.width/this.outWidth,s=this.outHeight*i;e.top+=(e.height-s)/2,e.bottom=e.top+s,e.right=e.left+this.outWidth*i}this.rect=e,this.setRect(this.rect)}onMoveCenterRight(t){const e=this.rect.clone();if(e.right+=t.x,this.outWidth&&this.outHeight){const i=e.width/this.outWidth,s=this.outHeight*i;e.top+=(e.height-s)/2,e.bottom=e.top+s,e.right=e.left+this.outWidth*i}this.rect=e,this.setRect(this.rect)}onMoveBottomLeft(t){const e=this.rect.clone();if(e.left+=t.x,e.bottom+=t.y,this.outWidth&&this.outHeight){const i=this.outWidth>this.outHeight?e.width/this.outWidth:e.height/this.outHeight;e.left+=e.width-this.outWidth*i,e.bottom=e.top+this.outHeight*i}this.rect=e,this.setRect(this.rect)}onMoveBottomCenter(t){const e=this.rect.clone();if(e.bottom+=t.y,this.outWidth&&this.outHeight){const i=e.height/this.outHeight,s=this.outWidth*i;e.left+=(e.width-s)/2,e.right=e.left+s,e.bottom=e.top+this.outHeight*i}this.rect=e,this.setRect(this.rect)}onMoveBottomRight(t){const e=this.rect.clone();if(e.right+=t.x,e.bottom+=t.y,this.outWidth&&this.outHeight){const i=this.outWidth>this.outHeight?e.width/this.outWidth:e.height/this.outHeight;e.right=e.left+this.outWidth*i,e.bottom=e.top+this.outHeight*i}this.rect=e,this.setRect(this.rect)}start(t){return super.start(t)?!0:this.checkPointInRect(t)?(this.isChecked=!0,this.mousePoint=t,!0):!1}move(t){return this.isChecked&&(this.onMoveLayout?.call(this,new o(t.x-this.mousePoint.x,t.y-this.mousePoint.y)),this.mousePoint=t),super.move(t)}end(t){return this.isChecked&&(this.onMoveLayout?.call(this,new o(t.x-this.mousePoint.x,t.y-this.mousePoint.y)),this.mousePoint=t,this.isChecked=!1),super.end(t)}setRect(t){super.setRect(t);const{left:e,top:i,right:s,bottom:h}=t,c=s-e,r=h-i,n=this.config.pointRadius*2;this.center.setRect(a.fromSize(e+c/2,i+r/2,n,n)),this.topLeft.setRect(a.fromSize(e,i,n,n)),this.topCenter.setRect(a.fromSize(e+c/2,i,n,n)),this.topRight.setRect(a.fromSize(s,i,n,n)),this.centerLeft.setRect(a.fromSize(e,i+r/2,n,n)),this.centerRight.setRect(a.fromSize(s,i+r/2,n,n)),this.bottomLeft.setRect(a.fromSize(e,h,n,n)),this.bottomCenter.setRect(a.fromSize(e+c/2,h,n,n)),this.bottomRight.setRect(a.fromSize(s,h,n,n))}drawMask(t){t.rect(this.rect.left,this.rect.top,this.rect.width,this.rect.height)}drawLine(t,e,i){t.save(),t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.closePath(),t.setLineDash([this.config.guidelineDsah,this.config.guidelineDsah]),t.lineWidth=this.config.guidelineWidth,t.strokeStyle=this.config.guidelineColor1,t.lineDashOffset=0,t.stroke(),t.strokeStyle=this.config.guidelineColor2,t.lineDashOffset=this.config.guidelineDsah,t.stroke(),t.restore()}draw(t){const{left:e,top:i,right:s,bottom:h}=this.rect;let c=s-e,r=h-i;t.lineWidth=this.config.borderWidth,t.beginPath(),t.rect(e-1,i-1,c+2,r+2),t.closePath(),t.strokeStyle=this.config.borderColor2,t.stroke(),t.beginPath(),t.rect(e,i,c,r),t.closePath(),t.strokeStyle=this.config.borderColor1,t.stroke(),c=c/3,r=r/3,this.drawLine(t,new o(e,i+r),new o(s,i+r)),this.drawLine(t,new o(e,i+r*2),new o(s,i+r*2)),this.drawLine(t,new o(e+c,i),new o(e+c,h)),this.drawLine(t,new o(e+c*2,i),new o(e+c*2,h)),super.draw(t)}setOutSize(t,e){this.outWidth=t,this.outHeight=e}}class l extends f{constructor(t,e,i,s="move",h){super(t,s,h),this.isChecked=!1,this.mousePoint=new o(0,0),this.onMoveLayout=null,this.onEndLayout=null,this.icon=e.clone(),this.icon.setAngle(i)}setOnMoveLayout(t){this.onMoveLayout=t}setOnEndLayout(t){this.onEndLayout=t}setRect(t){super.setRect(new a(t.left-this.config.pointRadius,t.top-this.config.pointRadius,t.right-this.config.pointRadius,t.bottom-this.config.pointRadius))}start(t){return this.checkPointInRect(t)?(this.isChecked=!0,this.mousePoint=t,!0):!1}move(t){return this.isChecked&&(this.onMoveLayout?.call(this,new o(t.x-this.mousePoint.x,t.y-this.mousePoint.y)),this.mousePoint=t),!1}end(t){return this.isChecked&&(this.onEndLayout?.call(this,new o(t.x-this.mousePoint.x,t.y-this.mousePoint.y)),this.mousePoint=t,this.isChecked=!1),!1}draw(t){t.save(),t.translate(this.rect.left,this.rect.top),this.icon.draw(t,this.rect.width,this.rect.height,this.config.borderColor1,this.config.borderColor2,this.config.borderWidth),t.restore()}}class k extends l{draw(t){t.save(),t.translate(this.rect.left,this.rect.top),this.icon.draw(t,this.rect.width,this.rect.height,this.config.borderColor2,this.config.borderColor1,this.config.borderWidth),t.restore()}}class S extends f{constructor(t,e="pointer",i){super(t,e,i),this.maskColor="#88888888",this.isSelect=!0,this.isChecked=!1,this.mousePoint=new o(0,0),this.onRotateLayout=null,this.handle=new C(this,"move",i),this.layoutList.push(this.handle)}setOnRotateLayout(t){this.onRotateLayout=t}setOnEndSelect(t){this.handle.setOnEndSelect(t)}start(t){return this.isSelect?!1:(super.start(t)||this.checkPointInRect(t)&&(this.isChecked=!0,this.mousePoint=t),!0)}move(t){if(this.isSelect)return!1;if(this.isChecked){const e=this.getRect(),i=new o(e.left+e.width/2,e.top+e.height/2),s=t.x-i.x,h=t.y-i.y,c=this.mousePoint.x-i.x,r=this.mousePoint.y-i.y,n=(Math.atan2(r,c)-Math.atan2(h,s))*(180/Math.PI);return this.onRotateLayout?.call(this,n),this.mousePoint=t,!0}return super.move(t),!0}end(t){return this.isSelect?!1:(this.isChecked=!1,super.end(t),!0)}setHandleRect(t){this.handle.setRect(t)}endSelect(t){this.handle.setRect(t),this.isSelect=!1}setOnMoveLayout(t){this.handle.setOnMoveLayout(t)}draw(t){const{left:e,top:i,right:s,bottom:h}=this.rect,c=s-e,r=h-i;t.save(),t.beginPath(),t.rect(e,i,c,r),this.handle.drawMask(t),t.closePath(),t.fillStyle=this.maskColor,t.fill("evenodd"),t.restore(),super.draw(t)}setOutSize(t,e){this.handle.setOutSize(t,e)}}class j extends f{constructor(t,e){super(null,"auto",e),this.overLayout=null,this.layoutList=[],this.outType=0,this.background=new b(this,e);const{width:i,height:s}=t.getBoundingClientRect();t.width=i,t.height=s,this.canvas=t,this.canvas2D=t.getContext("2d"),this.setRect(new a(0,0,this.canvas.width,this.canvas.height)),this.initBackground(),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mousemove",this.onMouseMove.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("wheel",this.onMouseWheel.bind(this)),t.addEventListener("touchstart",this.onTouchStart.bind(this)),t.addEventListener("touchmove",this.onTouchMove.bind(this)),t.addEventListener("touchend",this.onTouchEnd.bind(this)),this.draw(this.canvas2D)}setCursor(t){this.canvas.style.cursor=t}start(t){return super.start(t),this.draw(this.canvas2D),!0}move(t){return this.checkOverOut(t),super.move(t),this.draw(this.canvas2D),!0}end(t){return super.end(t),this.draw(this.canvas2D),!0}onTouchStart(t){t.preventDefault(),t.touches.length!==0&&this.start(new o(t.touches[0].clientX,t.touches[0].clientY))}onTouchMove(t){t.preventDefault(),t.touches.length!==0&&this.move(new o(t.touches[0].clientX,t.touches[0].clientY))}onTouchEnd(t){t.preventDefault(),this.end(new o(t.changedTouches[0].clientX,t.changedTouches[0].clientY))}onMouseDown(t){t.preventDefault(),this.start(new o(t.offsetX,t.offsetY))}onMouseMove(t){t.preventDefault(),this.move(new o(t.offsetX,t.offsetY))}onMouseUp(t){t.preventDefault(),this.end(new o(t.offsetX,t.offsetY))}onMouseOver(t){t.preventDefault(),this.over()}onMouseWheel(t){t.preventDefault(),this.wheel(new z(t.deltaX,t.deltaY,t.deltaZ)),this.draw(this.canvas2D)}setImage(t){this.image=new R(this),this.image.setRect(this.rect.clone()),this.image.setImage(t),this.image.setOutSize(this.outWidth,this.outHeight,this.outType),this.layoutList.push(this.image),this.draw(this.canvas2D)}setOverLayout(t){this.overLayout!=t&&(this.overLayout?.out(),this.overLayout=t,this.overLayout.over())}toDataUrl(t,e){return this.image?this.mask?this.image.toDataUrl(t,e):Promise.reject("No mask"):Promise.reject("No image")}toBlob(t,e){return this.image?this.mask?this.image.toBlob(t,e):Promise.reject("No mask"):Promise.reject("No image")}initBackground(){this.background.setRect(this.rect),this.layoutList.push(this.background),this.background.setOnStartSelect(t=>{this.mask||(this.mask=new S(this,`url(${m}), auto`,this.config),this.mask.setOutSize(this.outWidth,this.outHeight),this.mask.setOnMoveLayout(e=>{this.image?.moveImage(e)}),this.mask.setOnRotateLayout(e=>{this.image?.setRotate(e)}),this.mask.setOnEndSelect(e=>{this.image?.setClipRect(e.clone())}),this.mask.setRect(this.rect),this.mask.setHandleRect(t.clone()),this.layoutList.push(this.mask))}),this.background.setOnMoveSelect(t=>{this.mask?.setHandleRect(t.clone())}),this.background.setOnEndSelect(t=>{this.mask?.endSelect(t.clone()),this.image?.setClipRect(t.clone())})}reset(){this.mask?.remove(),this.mask=void 0,this.image?.reset(),this.draw(this.canvas2D)}setOutSize(t,e,i=0){this.outWidth=t,this.outHeight=e,this.outType=i,this.background?.setOutSize(t,e),this.image?.setOutSize(t,e,i),this.mask?.setOutSize(t,e)}}return j}));
